{% extends "nqueens/layout.html"%}


{% block title %}
    Solution 
{% endblock %}

{% block main %}
    <h3 class="mb-3">Here is the {{ n }}x{{ n }} board:</h3>
    <h5 class="mb-3">Try to solve it yourself!</h5>

    <table class="chessboard" id="nqueens-board">
        {% for row in board %}
        <tr>
            {% for col in row %}
                <td class="{% if col == 1 %}queen{% endif %}">
                    &nbsp;
                </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
    <input type="hidden" name="user_board" id="user_board">


    <form action="{% url 'check_solution' %}" method='POST' class="mt-3" id="nqueens-form">
        {% csrf_token %}
        <button class="btn btn-primary" name="action" value="check_board"> Check solution </button>
    </form>

    <form action="{% url 'solution' %}" method='POST' class="mt-3" id="nqueens-form">
        {% csrf_token %}
        <button class="btn btn-primary" name="action" value="get_solution"> Get a possible solution </button>
    </form>

    



    <script>
        const board = document.getElementById('nqueens-board');
        const userBoardInput = document.getElementById('user_board');
        const n = { n }; // Pass the size of the board from your Django view
        let queenCount = 0; // Counter for placed queens
    
        // Toggle queen placement on cell click
        board.addEventListener('click', function(event) {
            const cell = event.target;
            if (cell.tagName === 'TD') {
                const isQueenPlaced = cell.classList.toggle('queen');
                // Update queen count based on the action
                if (isQueenPlaced) {
                    queenCount++;
                } else {
                    queenCount--;
                }
                // Limit the number of queens to n
                if (queenCount > n) {
                    alert('You can only place up to ${n} queens!');
                    // Revert the last action if the limit is exceeded
                    cell.classList.remove('queen');
                    queenCount--;
                }
                updateUserBoard();
            }
        });
    
        // Update hidden input with current board state
        function updateUserBoard() {
            const boardState = [];
            for (let i = 0; i < n; i++) {
                const row = [];
                for (let j = 0; j < n; j++) {
                    const cell = board.rows[i].cells[j];
                    row.push(cell.classList.contains('queen') ? 1 : 0); // 1 for queen, 0 for empty
                }
                boardState.push(row);
            }
    
            userBoardInput.value = JSON.stringify(boardState);
        }
    </script>

{% endblock %}